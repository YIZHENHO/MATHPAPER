<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>長輩大腦活化數學產生器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @media print {
            body { background: white; }
            .no-print { display: none !important; }
            .sheet-page { 
                margin: 0 !important; 
                box-shadow: none !important; 
                page-break-after: always;
                width: 210mm;
                height: 297mm;
            }
            @page { 
                size: A4; 
                margin: 0; 
            }
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .sheet-page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            margin: 0 auto;
            padding: 20mm;
            box-sizing: border-box;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans min-h-screen">

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- 側邊設定欄 -->
        <div class="no-print w-full md:w-80 bg-white shadow-xl p-6 z-10 overflow-y-auto max-h-screen md:sticky md:top-0">
            <div class="flex items-center gap-2 mb-6">
                <i data-lucide="settings" class="text-blue-600"></i>
                <h1 class="text-2xl font-bold text-gray-800">產生器設定</h1>
            </div>

            <div class="space-y-5">
                <!-- 標題 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">練習卷標題</label>
                    <input type="text" id="cfg-title" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-500" value="長輩大腦活化練習">
                </div>

                <!-- 數字範圍 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">數字範圍 (最小 ~ 最大)</label>
                    <div class="flex items-center gap-2">
                        <input type="number" id="cfg-min" class="w-1/2 border rounded-lg p-2 text-center" value="1">
                        <span>~</span>
                        <input type="number" id="cfg-max" class="w-1/2 border rounded-lg p-2 text-center" value="20">
                    </div>
                </div>

                <!-- 運算符號 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">包含運算</label>
                    <div class="flex gap-2" id="op-container">
                        <button onclick="toggleOp('+')" data-op="+" class="op-btn flex-1 py-2 rounded-lg font-bold border bg-blue-600 text-white border-blue-600">+</button>
                        <button onclick="toggleOp('-')" data-op="-" class="op-btn flex-1 py-2 rounded-lg font-bold border bg-white text-gray-600 border-gray-300">-</button>
                        <button onclick="toggleOp('×')" data-op="×" class="op-btn flex-1 py-2 rounded-lg font-bold border bg-white text-gray-600 border-gray-300">×</button>
                        <button onclick="toggleOp('÷')" data-op="÷" class="op-btn flex-1 py-2 rounded-lg font-bold border bg-white text-gray-600 border-gray-300">÷</button>
                    </div>
                </div>

                <!-- 數量設定 -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">每頁題數</label>
                        <input type="number" id="cfg-pp" class="w-full border rounded-lg p-2 text-center" value="20">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">產生份數</label>
                        <input type="number" id="cfg-sheets" class="w-full border rounded-lg p-2 text-center" value="1">
                    </div>
                </div>

                <!-- 解答開關 -->
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="cfg-ans" class="w-5 h-5 text-blue-600 rounded" checked>
                    <span class="text-gray-700 font-medium">產生解答頁</span>
                </label>

                <!-- 按鈕區 -->
                <div class="space-y-3 pt-4">
                    <button onclick="generate()" class="w-full bg-blue-100 text-blue-700 hover:bg-blue-200 font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-all">
                        <i data-lucide="refresh-cw" size="20"></i> 重新產生題目
                    </button>
                    <button onclick="window.print()" class="w-full bg-blue-600 text-white hover:bg-blue-700 font-bold py-3 rounded-xl flex items-center justify-center gap-2 shadow-lg transition-all">
                        <i data-lucide="printer" size="20"></i> 列印 / 下載 PDF
                    </button>
                </div>

                <p class="text-xs text-gray-400 text-center mt-4 italic">
                    提示：列印時目的地選擇「另存為 PDF」。
                </p>
            </div>
        </div>

        <!-- 預覽區域 -->
        <div class="flex-1 p-4 md:p-10 bg-gray-200 overflow-y-auto" id="preview-area">
            <!-- JavaScript 會在這裡插入題目頁面 -->
        </div>
    </div>

    <script>
        let selectedOps = ['+'];
        
        function toggleOp(op) {
            if (selectedOps.includes(op)) {
                if (selectedOps.length > 1) {
                    selectedOps = selectedOps.filter(o => o !== op);
                }
            } else {
                selectedOps.push(op);
            }
            updateOpUI();
            generate();
        }

        function updateOpUI() {
            document.querySelectorAll('.op-btn').forEach(btn => {
                const op = btn.getAttribute('data-op');
                if (selectedOps.includes(op)) {
                    btn.classList.remove('bg-white', 'text-gray-600', 'border-gray-300');
                    btn.classList.add('bg-blue-600', 'text-white', 'border-blue-600');
                } else {
                    btn.classList.add('bg-white', 'text-gray-600', 'border-gray-300');
                    btn.classList.remove('bg-blue-600', 'text-white', 'border-blue-600');
                }
            });
        }

        function generate() {
            const title = document.getElementById('cfg-title').value;
            const minNum = parseInt(document.getElementById('cfg-min').value) || 0;
            const maxNum = parseInt(document.getElementById('cfg-max').value) || 1;
            const problemsPerPage = parseInt(document.getElementById('cfg-pp').value) || 20;
            const sheetCount = parseInt(document.getElementById('cfg-sheets').value) || 1;
            const showAnswers = document.getElementById('cfg-ans').checked;

            const previewArea = document.getElementById('preview-area');
            previewArea.innerHTML = '';

            const allSheetsData = [];

            for (let s = 0; s < sheetCount; s++) {
                const problems = [];
                for (let i = 0; i < problemsPerPage; i++) {
                    let op = selectedOps[Math.floor(Math.random() * selectedOps.length)];
                    let n1, n2, ans;

                    if (op === '+') {
                        n1 = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
                        n2 = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
                        ans = n1 + n2;
                    } else if (op === '-') {
                        n1 = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
                        n2 = Math.floor(Math.random() * (n1 - minNum + 1)) + minNum;
                        ans = n1 - n2;
                    } else if (op === '×') {
                        let mMax = Math.min(maxNum, 12);
                        n1 = Math.floor(Math.random() * (mMax - 2 + 1)) + 2;
                        n2 = Math.floor(Math.random() * (mMax - 2 + 1)) + 2;
                        ans = n1 * n2;
                    } else if (op === '÷') {
                        let dMax = Math.min(maxNum, 10);
                        n2 = Math.floor(Math.random() * (dMax - 2 + 1)) + 2;
                        ans = Math.floor(Math.random() * (dMax - 2 + 1)) + 2;
                        n1 = n2 * ans;
                    }
                    problems.push({ n1, n2, op, ans });
                }
                allSheetsData.push(problems);

                // 渲染題目頁
                const sheetDiv = document.createElement('div');
                sheetDiv.className = 'sheet-page shadow-lg mb-8';
                sheetDiv.innerHTML = `
                    <div class="border-b-4 border-black pb-4 mb-8 flex justify-between items-end">
                        <div>
                            <h2 class="text-4xl font-black mb-2">${title}</h2>
                            <p class="text-gray-600">日期：________________  姓名：________________</p>
                        </div>
                        <div class="text-right text-sm text-gray-400">份數: ${s + 1}</div>
                    </div>
                    <div class="grid grid-cols-2 gap-y-12 gap-x-12">
                        ${problems.map((p, idx) => `
                            <div class="flex items-center text-3xl font-medium">
                                <span class="w-10 text-xl text-gray-400 font-normal">(${idx + 1})</span>
                                <div class="flex items-center gap-4">
                                    <span class="w-12 text-right">${p.n1}</span>
                                    <span class="w-6 text-center">${p.op}</span>
                                    <span class="w-12 text-left">${p.n2}</span>
                                    <span class="mx-2">=</span>
                                    <div class="w-24 h-12 border-b-2 border-dashed border-gray-400"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="mt-20 text-center text-gray-300 border-t pt-4 text-sm">多活動大腦，保持身心健康</div>
                `;
                previewArea.appendChild(sheetDiv);
            }

            // 渲染解答頁
            if (showAnswers) {
                allSheetsData.forEach((problems, sIdx) => {
                    const ansDiv = document.createElement('div');
                    ansDiv.className = 'sheet-page shadow-lg mb-8';
                    ansDiv.innerHTML = `
                        <div class="border-b-2 border-gray-800 pb-2 mb-8">
                            <h2 class="text-2xl font-bold">解答頁 - ${title} (第 ${sIdx + 1} 份)</h2>
                        </div>
                        <div class="grid grid-cols-4 gap-6">
                            ${problems.map((p, idx) => `
                                <div class="border p-3 rounded text-xl flex justify-between bg-gray-50">
                                    <span class="text-gray-400 text-sm">(${idx + 1})</span>
                                    <span class="font-bold text-blue-700">${p.ans}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    previewArea.appendChild(ansDiv);
                });
            }
        }

        // 初始化
        window.onload = () => {
            lucide.createIcons();
            generate();
        };
    </script>
</body>
</html>
