<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>長輩數學練習產生器</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }

        @media print {
            .no-print {
                display: none !important;
            }
            body {
                background-color: white !important;
                margin: 0;
                padding: 0;
            }
            .sheet-page {
                box-shadow: none !important;
                margin: 0 !important;
                padding: 15mm !important;
                page-break-after: always;
                width: 210mm !important;
                height: 297mm !important;
            }
            @page {
                size: A4;
                margin: 0;
            }
        }

        /* 隱藏 Chrome/Safari 的數字輸入箭頭 */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .sheet-page {
            width: 210mm;
            min-height: 297mm;
            box-sizing: border-box;
        }

        .answer-underline {
            width: 100px;
            height: 40px;
            border-bottom: 2px dashed #9ca3af;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col md:flex-row min-h-screen">

    <!-- 側邊設定欄 (列印時隱藏) -->
    <div class="no-print w-full md:w-80 bg-white shadow-xl p-6 z-10 overflow-y-auto max-h-screen sticky top-0">
        <div class="flex items-center gap-2 mb-6">
            <i data-lucide="settings" class="text-blue-600"></i>
            <h1 class="text-2xl font-bold text-gray-800">產生器設定</h1>
        </div>

        <div class="space-y-6">
            <!-- 標題 -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">練習卷標題</label>
                <input id="config-title" type="text" value="長輩大腦活化練習" 
                    class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-500 outline-none">
            </div>

            <!-- 難度：數字範圍 -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">數字範圍 (最小 ~ 最大)</label>
                <div class="flex items-center gap-2">
                    <input id="config-minNum" type="number" value="1" class="w-1/2 border rounded-lg p-2">
                    <span>~</span>
                    <input id="config-maxNum" type="number" value="20" class="w-1/2 border rounded-lg p-2">
                </div>
            </div>

            <!-- 運算符號 -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">包含運算</label>
                <div id="op-group" class="flex gap-2">
                    <button data-op="+" class="op-btn flex-1 py-2 rounded-lg font-bold border bg-blue-600 text-white border-blue-600">+</button>
                    <button data-op="-" class="op-btn flex-1 py-2 rounded-lg font-bold border bg-white text-gray-600 border-gray-300">-</button>
                    <button data-op="×" class="op-btn flex-1 py-2 rounded-lg font-bold border bg-white text-gray-600 border-gray-300">×</button>
                    <button data-op="÷" class="op-btn flex-1 py-2 rounded-lg font-bold border bg-white text-gray-600 border-gray-300">÷</button>
                </div>
            </div>

            <!-- 數量設定 -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">每頁題數</label>
                    <input id="config-problemsPerPage" type="number" value="20" class="w-full border rounded-lg p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">產生份數</label>
                    <input id="config-sheetCount" type="number" value="1" class="w-full border rounded-lg p-2">
                </div>
            </div>

            <!-- 解答開關 -->
            <label class="flex items-center gap-2 cursor-pointer">
                <input id="config-showAnswers" type="checkbox" checked class="w-5 h-5 text-blue-600 rounded">
                <span class="text-gray-700 font-medium">產生解答頁</span>
            </label>

            <!-- 操作按鈕 -->
            <div class="space-y-3 pt-4">
                <button id="btn-generate" class="w-full bg-blue-100 text-blue-700 hover:bg-blue-200 font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-all">
                    <i data-lucide="refresh-cw" size="20"></i> 重新產生題目
                </button>
                <button onclick="window.print()" class="w-full bg-blue-600 text-white hover:bg-blue-700 font-bold py-3 rounded-xl flex items-center justify-center gap-2 shadow-lg transition-all">
                    <i data-lucide="printer" size="20"></i> 列印 / 下載 PDF
                </button>
            </div>

            <p class="text-xs text-gray-400 text-center mt-4 italic">
                提示：列印時請選擇「另存為 PDF」即可下載。
            </p>
        </div>
    </div>

    <!-- 預覽區域 -->
    <div id="preview-area" class="flex-1 p-4 md:p-10 overflow-y-auto bg-gray-200 flex flex-col items-center space-y-8">
        <!-- 內容將由 JS 動態產生 -->
    </div>

    <script>
        // 設定與資料狀態
        let config = {
            minNum: 1,
            maxNum: 20,
            operations: ['+'],
            problemsPerPage: 20,
            sheetCount: 1,
            showAnswers: true,
            title: "長輩大腦活化練習"
        };

        let sheets = [];

        // 初始化運算按鈕點擊事件
        document.querySelectorAll('.op-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const op = btn.getAttribute('data-op');
                if (config.operations.includes(op)) {
                    if (config.operations.length > 1) {
                        config.operations = config.operations.filter(o => o !== op);
                        btn.classList.replace('bg-blue-600', 'bg-white');
                        btn.classList.replace('text-white', 'text-gray-600');
                        btn.classList.replace('border-blue-600', 'border-gray-300');
                    }
                } else {
                    config.operations.push(op);
                    btn.classList.replace('bg-white', 'bg-blue-600');
                    btn.classList.replace('text-gray-600', 'text-white');
                    btn.classList.replace('border-gray-300', 'border-blue-600');
                }
                generateAndRender();
            });
        });

        // 綁定輸入更新
        const syncInput = (id, key, isInt = true) => {
            const el = document.getElementById(id);
            el.addEventListener('input', (e) => {
                config[key] = isInt ? (parseInt(e.target.value) || 0) : e.target.value;
                generateAndRender();
            });
        };

        syncInput('config-title', 'title', false);
        syncInput('config-minNum', 'minNum');
        syncInput('config-maxNum', 'maxNum');
        syncInput('config-problemsPerPage', 'problemsPerPage');
        syncInput('config-sheetCount', 'sheetCount');
        
        document.getElementById('config-showAnswers').addEventListener('change', (e) => {
            config.showAnswers = e.target.checked;
            renderAll();
        });

        document.getElementById('btn-generate').addEventListener('click', generateAndRender);

        // 產生題目邏輯
        function generateProblems() {
            sheets = [];
            for (let s = 0; s < config.sheetCount; s++) {
                const problems = [];
                for (let i = 0; i < config.problemsPerPage; i++) {
                    let op = config.operations[Math.floor(Math.random() * config.operations.length)];
                    let n1, n2, ans;

                    if (op === '+') {
                        n1 = Math.floor(Math.random() * (config.maxNum - config.minNum + 1)) + config.minNum;
                        n2 = Math.floor(Math.random() * (config.maxNum - config.minNum + 1)) + config.minNum;
                        ans = n1 + n2;
                    } else if (op === '-') {
                        n1 = Math.floor(Math.random() * (config.maxNum - config.minNum + 1)) + config.minNum;
                        n2 = Math.floor(Math.random() * (n1 - config.minNum + 1)) + config.minNum;
                        ans = n1 - n2;
                    } else if (op === '×') {
                        const multMax = Math.min(config.maxNum, 12);
                        n1 = Math.floor(Math.random() * (multMax - 2 + 1)) + 2;
                        n2 = Math.floor(Math.random() * (multMax - 2 + 1)) + 2;
                        ans = n1 * n2;
                    } else if (op === '÷') {
                        n2 = Math.floor(Math.random() * (Math.min(config.maxNum, 10) - 2 + 1)) + 2;
                        ans = Math.floor(Math.random() * (Math.min(config.maxNum, 10) - 2 + 1)) + 2;
                        n1 = n2 * ans;
                    }
                    problems.push({ n1, n2, op, ans });
                }
                sheets.push({ id: s, problems });
            }
        }

        // 渲染 HTML
        function renderAll() {
            const container = document.getElementById('preview-area');
            container.innerHTML = '';

            // 渲染練習頁
            sheets.forEach((sheet, idx) => {
                const page = document.createElement('div');
                page.className = 'sheet-page bg-white shadow-lg p-[20mm]';
                
                let problemsHtml = sheet.problems.map((p, pIdx) => `
                    <div class="flex items-center text-3xl font-medium tracking-wider">
                        <span class="w-10 text-xl text-gray-400 font-normal">(${pIdx + 1})</span>
                        <div class="flex items-center gap-4">
                            <span class="w-12 text-right">${p.n1}</span>
                            <span class="w-6 text-center">${p.op}</span>
                            <span class="w-12 text-left">${p.n2}</span>
                            <span class="mx-2">=</span>
                            <div class="answer-underline"></div>
                        </div>
                    </div>
                `).join('');

                page.innerHTML = `
                    <div class="border-b-4 border-black pb-4 mb-8 flex justify-between items-end">
                        <div>
                            <h2 class="text-4xl font-black mb-2">${config.title}</h2>
                            <p class="text-gray-600">日期：________________  姓名：________________</p>
                        </div>
                        <div class="text-right text-sm text-gray-400">份數: #${sheet.id + 1}</div>
                    </div>
                    <div class="grid grid-cols-2 gap-y-10 gap-x-12">
                        ${problemsHtml}
                    </div>
                    <div class="mt-20 text-center text-gray-300 border-t pt-4 text-sm">
                        多活動大腦，保持身心健康
                    </div>
                `;
                container.appendChild(page);
            });

            // 渲染答案頁
            if (config.showAnswers) {
                sheets.forEach((sheet, idx) => {
                    const ansPage = document.createElement('div');
                    ansPage.className = 'sheet-page bg-white shadow-lg p-[20mm]';
                    
                    let ansHtml = sheet.problems.map((p, pIdx) => `
                        <div class="border p-3 rounded text-xl flex justify-between bg-gray-50">
                            <span class="text-gray-400 text-sm">(${pIdx + 1})</span>
                            <span class="font-bold text-blue-700">${p.ans}</span>
                        </div>
                    `).join('');

                    ansPage.innerHTML = `
                        <div class="border-b-2 border-gray-800 pb-2 mb-8">
                            <h2 class="text-2xl font-bold">解答頁 - ${config.title} (份數: #${sheet.id + 1})</h2>
                        </div>
                        <div class="grid grid-cols-4 gap-4">
                            ${ansHtml}
                        </div>
                    `;
                    container.appendChild(ansPage);
                });
            }
            
            // 重新初始化圖標
            lucide.createIcons();
        }

        function generateAndRender() {
            generateProblems();
            renderAll();
        }

        // 初始執行
        window.onload = () => {
            generateAndRender();
        };
    </script>
</body>
</html>
